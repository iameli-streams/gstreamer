<!DOCTYPE html>
<html lang="en">
<head>

<base href="..">

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>streamsynchronizer</title>

<link rel="stylesheet" href="assets/css/dark-frontend.css" type="text/css" title="dark">
<link rel="alternate stylesheet" href="assets/css/light-frontend.css" type="text/css" title="light">
<link rel="stylesheet" href="assets/css/bootstrap-toc.min.css" type="text/css">
<link rel="stylesheet" href="assets/css/jquery.mCustomScrollbar.min.css">
<link rel="stylesheet" href="assets/js/search/enable_search.css" type="text/css">

<link rel="stylesheet" href="assets/css/extra_frontend.css" type="text/css">
<link rel="stylesheet" href="assets/css/devhelp.css" type="text/css">

<link rel="stylesheet" href="assets/css/prism-tomorrow.css" type="text/css" title="dark">

<link rel="alternate stylesheet" href="assets/css/prism.css" type="text/css" title="light">

<script src="assets/js/mustache.min.js"></script>
<script src="assets/js/jquery.js"></script>
<script src="assets/js/bootstrap.js"></script>
<script src="assets/js/scrollspy.js"></script>
<script src="assets/js/typeahead.jquery.min.js"></script>
<script src="assets/js/search.js"></script>
<script src="assets/js/compare-versions.js"></script>
<script src="assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="assets/js/bootstrap-toc.min.js"></script>
<script src="assets/js/jquery.touchSwipe.min.js"></script>
<script src="assets/js/anchor.min.js"></script>
<script src="assets/js/tag_filtering.js"></script>
<script src="assets/js/language_switching.js"></script>
<script src="assets/js/styleswitcher.js"></script>

<script src="assets/js/lines_around_headings.js"></script>

<script src="assets/js/prism-core.js"></script>
<script src="assets/js/prism-autoloader.js"></script>
<script src="assets/js/prism_autoloader_path_override.js"></script>
<script src="assets/js/trie.js"></script>

<!-- generic -->
<link rel="icon" type="image/png" href="assets/images/favicon-16.png" sizes="16x16">
<link rel="icon" type="image/png" href="assets/images/favicon-32.png" sizes="32x32">
<link rel="icon" type="image/png" href="assets/images/favicon-57.png" sizes="57x57">
<link rel="icon" type="image/png" href="assets/images/favicon-64.png" sizes="64x64">
<link rel="icon" type="image/png" href="assets/images/favicon-76.png" sizes="76x76">
<link rel="icon" type="image/png" href="assets/images/favicon-96.png" sizes="96x96">
<link rel="icon" type="image/png" href="assets/images/favicon-128.png" sizes="128x128">
<link rel="icon" type="image/png" href="assets/images/favicon-192.png" sizes="192x192">
<link rel="icon" type="image/png" href="assets/images/favicon-228.png" sizes="228x228">

<!-- Android -->
<link rel="shortcut icon" sizes="196x196" href="assets/images/favicon-196.png">

<!-- iOS -->
<link rel="apple-touch-icon" href="assets/images/favicon-120.png" sizes="120x120">
<link rel="apple-touch-icon" href="assets/images/favicon-152.png" sizes="152x152">
<link rel="apple-touch-icon" href="assets/images/favicon-180.png" sizes="180x180">

</head>

<body class="no-script
">

<script>
$('body').removeClass('no-script');
</script>

<nav class="navbar navbar-fixed-top navbar-default" id="topnav">
	<div class="container-fluid">
		<div class="navbar-right">
			<a id="toc-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-wrapper" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<span title="light mode switch" class="glyphicon glyphicon-sunglasses pull-right" id="lightmode-icon"></span>
			<form class="navbar-form pull-right" id="navbar-search-form">
                               <div class="form-group has-feedback">
                                       <input type="text" class="form-control input-sm" name="search" id="sidenav-lookup-field" placeholder="search" disabled>
				       <span class="glyphicon glyphicon-search form-control-feedback" id="search-mgn-glass"></span>
                               </div>
                        </form>
		</div>
		<div class="navbar-header">
			<a id="sidenav-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<a id="home-link" href="index.html" class="hotdoc-navbar-brand">
				<img src="assets/images/gstreamer-logo.svg" alt="Home">
			</a>
		</div>
		<div class="navbar-collapse collapse" id="navbar-wrapper">
			<ul class="nav navbar-nav" id="menu">
				
<li class="dropdown">
    <a class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        API References<span class="caret"></span>
    </a>
	<ul class="dropdown-menu" id="modules-menu">
					<li>
				<a href="gstreamer/gi-index.html">GStreamer core</a>
			</li>
					<li>
				<a href="libs.html">GStreamer Libraries</a>
			</li>
					<li>
				<a href="plugins_doc.html">GStreamer Plugins</a>
			</li>
		</ul>
</li>

<li>
    <a href="application-development/index.html">Application manual</a>
</li>


<li>
    <a href="tutorials/index.html">Tutorials</a>
</li>

			</ul>
			<div class="hidden-xs hidden-sm navbar-text navbar-center">
							</div>
		</div>
	</div>
</nav>

<main>
<div data-extension="gst-extension" data-hotdoc-in-toplevel="False" data-hotdoc-project="playback" data-hotdoc-ref="streamsynchronizer.html" class="page_container" id="page-wrapper" data-hotdoc-meta-gi-languages="['c', 'javascript', 'python']">
<script src="assets/js/utils.js"></script>

<div class="panel panel-collapse oc-collapsed" id="sidenav" data-hotdoc-role="navigation">
	<script src="assets/js/full-width.js"></script>
  <div id="sitenav-wrapper">
    <iframe src="hotdoc-sitemap.html" id="sitenav-frame"></iframe>
  </div>
</div>

<div id="body">
	<div id="main">
				    <div id="page-description" data-hotdoc-role="main">
        <h1 id="streamsynchronizer-page">streamsynchronizer</h1>
<p>Enables gapless playback of heterogenous streams groups. This element is
used inside <a href="playback/playsink.html#playsink">playsink</a>.</p>
<p><a href="playback/streamsynchronizer.html#streamsynchronizer">streamsynchronizer</a> ensures only one stream group is active downstream at any
given time. Whenever a pad receives a <code>STREAM_START</code> with a group-id
different than the current one the pad is blocked until all other pads also
receive a <code>STREAM_START</code> with the same group-id.</p>
<p>Once all pads have received a <code>STREAM_START</code> with the same group-id, the
previous group is completed and all the pads unblocked.</p>
<p>When a group is completed, a patched <a href="gstreamer/gstsegment.html#GstSegment" data-gi-href-javascript="gstreamer/gstsegment.html#GstSegment" data-gi-title-javascript="Gst.Segment" data-gi-href-python="gstreamer/gstsegment.html#GstSegment" data-gi-title-python="Gst.Segment">GstSegment</a> is emitted downstream so
that the running time 0 from upstream of the new group becomes the running
time of the end of the previous group.</p>
<h3 id="warning-deadlocks-with-multiple-pads-with-different-groupids">Warning: deadlocks with multiple pads with different group-ids</h3>
<p>All pads connected to a streamsynchronizer are expected to share a group-id.
Therefore, sending <code>STREAM_START</code> in two or more sinkpads of
<a href="playback/streamsynchronizer.html#streamsynchronizer">streamsynchronizer</a> with different group-ids will not allow for playback.</p>
<p>As <a href="playback/streamsynchronizer.html#streamsynchronizer">streamsynchronizer</a> is part of <a href="playback/playsink.html#playsink">playsink</a>, this can easily happen
accidentally when mixing streams from different elements. The following is a
minimal naive pipeline exhibiting this problem:</p>
<pre><code class="language-["> # Will get stuck! The streams from audiotestsrc and videotestsrc don't
 # share a group-id.
 gst-launch-1.0 \
   playsink name=myplaysink \
   audiotestsrc ! myplaysink.audio_sink \
   videotestsrc ! myplaysink.video_sink
</code></pre>
<h2 id="what-are-stream-groups-and-groupids">What are stream groups and group-ids</h2>
<p>A stream group is a group of streams that are meant to be played together.
Two streams belong to the same group if they set the same group-id in their
<code>STREAM_START</code> event (see <a href="gstreamer/gstevent.html#gst_event_set_group_id" data-gi-href-javascript="gstreamer/gstevent.html#gst_event_set_group_id" data-gi-title-javascript="Gst.Event.prototype.set_group_id" data-gi-href-python="gstreamer/gstevent.html#gst_event_set_group_id" data-gi-title-python="Gst.Event.set_group_id">gst_event_set_group_id</a>).</p>
<p>The most common example is video and audio from the same .mp4 file. Demuxers
will ensure that the streams they output from their srcpads share the same
group-id.</p>
<p>Another example is an out-of-band .srt subtitles file. In this case, despite
being a separate file, the subtitle stream should use the same group-id as
the video its meant to be used with, as they both need to be played together.
uridecodebin3 takes care of this automatically.</p>
<h2 id="why-do-we-need-stream-groups-for-gapless-playback">Why do we need stream groups for gapless playback</h2>
<p>In theory, a player could implement gapless playback by performing some kind
of auto-plugging, keeping track of the playlists themselves and adding probes
to patch the <a href="gstreamer/gstsegment.html#GstSegment" data-gi-href-javascript="gstreamer/gstsegment.html#GstSegment" data-gi-title-javascript="Gst.Segment" data-gi-href-python="gstreamer/gstsegment.html#GstSegment" data-gi-title-python="Gst.Segment">GstSegment</a>. This is a lot of work, especially to get it done
correctly.</p>
<p>The goal of <a href="playback/streamsynchronizer.html#streamsynchronizer">streamsynchronizer</a> and group-ids is to standardize a solution
for gapless playback so that applications don't have to implement it from the
ground up, and for that solution to be generalizable to the worst possible
cases.</p>
<p>Every new stream group received upstream of streamsynchronizer is expected
to start at running-time of zero. Hence, once the previous file is drained,
you can even remove a demuxer element and replace it by a demuxer for a
different format, and streamsynchronizer will take care of adjusting the
segment so that the data of the second file plays after the second.
If there is more than one stream within the same group (e.g. audio and video)
the shift will be done by the duration of the longest stream.</p>
<h2 id="gapless-playback-caveats">Gapless playback caveats</h2>
<p>Given the substantial number of edge cases that need to be handled across a
large code surface, bugs in gapless playback are not uncommon.</p>
<p>In general (not only in GStreamer) gapless playback requires several things
to work:</p>
<ul>
<li>
<p>Buffering of the new file done well ahead of the previous file.
For this purpose <a href="playback/urisourcebin.html#urisourcebin">urisourcebin</a> emits (and <a href="playback/decodebin3.html#decodebin3">decodebin3</a>, <a href="playback/uridecodebin3.html#uridecodebin3">uridecodebin3</a>,
<a href="playback/playbin.html#playbin">playbin</a> and <a href="playback/playbin3.html#playbin3">playbin3</a> propagate) the <a href="playback/urisourcebin.html#urisourcebin::about-to-finish">about-to-finish</a>
signal to notify what is the optimal time at which to provide the next uri
to play.</p>
<ul>
<li>Note that this requirement applies to the entire pipeline, including
decoders and audio sinks.</li>
</ul>
</li>
<li>
<p>Extremely well bounded audio files. This is particularly hard for
compressed audio formats. See: codec delay, audio frame sizes. Achieving
arbitrary length of audio in many compressed formats will require either:</p>
<ul>
<li>Container features like MP4 edit lists to clip the priming and padding
PCM samples at the beginning and the end of the file, plus elements
correctly clipping the data accordingly.</li>
<li>Features of the specific audio format used to perform the same clipping
at the decoder level.</li>
</ul>
</li>
<li>
<p>All autoplugging during the switch must be done without pausing the
pipeline.</p>
</li>
<li>
<p>Playback must be possible without resetting the audio device (e.g. to
select a different sampling rate or audio format), or such a switch to be
done gapless.</p>
</li>
</ul>
<h2 id="example-command-line">Example command line</h2>
<p>gst-play supports the <code>--gapless</code> flag which can be used to test gapless
playback. It will instantiate a playbin/playbin3 with a <a href="playback/playsink.html#playsink">playsink</a>, which
itself will contain a <a href="playback/streamsynchronizer.html#streamsynchronizer">streamsynchronizer</a>.</p>
<pre><code class="language-["> # BEWARE: high-pitch audio sweep, lower your volume.
 wget https://www2.iis.fraunhofer.de/AAC/gapless-sweep_part1_iis.m4a
 wget https://www2.iis.fraunhofer.de/AAC/gapless-sweep_part2_iis.m4a
 gst-play-1.0 --gapless \
   gapless-sweep_part1_iis.m4a \
   gapless-sweep_part2_iis.m4a \
</code></pre>

    </div>
        
        
                    

<div class="base_symbol_container" data-hotdoc-tags="" id="streamsynchronizer">
	
        

        <h2>Hierarchy</h2>
            <div class="hierarchy_container">
                <div class="hierarchy_details">
<pre>
GObject
    <span class="lineart">╰──</span>GInitiallyUnowned
        <span class="lineart">╰──</span><a title="GstObject" href="gstreamer/gstobject.html#GstObject" data-gi-href-javascript="gstreamer/gstobject.html#GstObject" data-gi-title-javascript="Gst.Object" data-gi-href-python="gstreamer/gstobject.html#GstObject" data-gi-title-python="Gst.Object">GstObject</a>
            <span class="lineart">╰──</span><a title="GstElement" href="gstreamer/gstelement.html#GstElement" data-gi-href-javascript="gstreamer/gstelement.html#GstElement" data-gi-title-javascript="Gst.Element" data-gi-href-python="gstreamer/gstelement.html#GstElement" data-gi-title-python="Gst.Element">GstElement</a>
                <span class="lineart">╰──</span>streamsynchronizer
</pre>

</div>

            </div>
        <h2 class="symbol_section">Factory details</h2>
        <div class="symbol-detail">
            <p><b>Authors:</b> – Sebastian Dröge <sebastian.droege></sebastian.droege></p>
            <p><b>Classification:</b> – <code>Generic</code></p>
            <p><b>Rank</b> – none</p>
            <p><b>Plugin</b> – playback</p>
            <p><b>Package</b> – GStreamer Base Plug-ins</p>
        </div>

</div>


            <h2 class="symbol_section">Pad Templates</h2>
                    

<div class="base_symbol_container" data-hotdoc-tags="" id="GstStreamSynchronizer!sink_%u">
	



        <h3><span><code>sink_%u</code></span></h3>


        <div>
            
            <pre class="language-yaml"><code class="language-yaml">ANY</code></pre>
            <div class="symbol-detail">
                <p><b>Presence</b> – <i>request</i></p>
                <p><b>Direction</b> – <i>sink</i></p>
                    <p><b>Object type</b> – <a title="GstPad" href="gstreamer/gstpad.html#GstPad" data-gi-href-javascript="gstreamer/gstpad.html#GstPad" data-gi-title-javascript="Gst.Pad" data-gi-href-python="gstreamer/gstpad.html#GstPad" data-gi-title-python="Gst.Pad">GstPad</a></p>
            </div>
        </div>



<hr>

</div>

            

<div class="base_symbol_container" data-hotdoc-tags="" id="GstStreamSynchronizer!src_%u">
	



        <h3><span><code>src_%u</code></span></h3>


        <div>
            
            <pre class="language-yaml"><code class="language-yaml">ANY</code></pre>
            <div class="symbol-detail">
                <p><b>Presence</b> – <i>sometimes</i></p>
                <p><b>Direction</b> – <i>src</i></p>
                    <p><b>Object type</b> – <a title="GstPad" href="gstreamer/gstpad.html#GstPad" data-gi-href-javascript="gstreamer/gstpad.html#GstPad" data-gi-title-javascript="Gst.Pad" data-gi-href-python="gstreamer/gstpad.html#GstPad" data-gi-title-python="Gst.Pad">GstPad</a></p>
            </div>
        </div>



<hr>

</div>






		
	</div>
	<div id="search_results">
		<p>The results of the search are</p>
	</div>
	<div id="footer">
		    

	</div>
</div>

<div id="toc-column">
	
		<div class="edit-button">
		

	</div>
		<div id="toc-wrapper">
		<nav id="toc"></nav>
	</div>
</div>
</div>
</main>


<script src="assets/js/navbar_offset_scroller.js"></script>
</body>
</html>
